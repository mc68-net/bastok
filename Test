#!/usr/bin/env bash

die() {
    local exitcode="$1"; shift
    [[ -z $1 ]] || echo 1>&2 "$@"
    exit $exitcode
}

#   Unit Tests
$b8tool pytest -- "$@"

#   Functional tests are run only if we ran all unit tests. (This is not
#   the best way to avoid running them when unwanted, but it's a convenient
#   hack for the moment.)
[[ ${#@} = 0 ]] && {
    #   We run them in quiet mode here, but if they fail you want
    #   to do this manually without the -q.
    ./b8tool/pylib/cmtconv/Test -q \
        || die $? "FAILED: cmtconv/Test (exitcode=$?)"
} || true
