from    bastok.blines import blines, stripeol
import  pytest

@pytest.mark.parametrize('result, input', [
    #   Ignore lines before first bline
    ([],                        ['']),
    ([],                        ['foo']),
    (['56 ef'],                 ['ab', '', 'cd', '56 ef',]),
    #   Leading/trailing spaces, comments and blank lines stripped.
    (['123 ab'],                ['  123 ab  ']),
    (['123 ab'],                ['123 ab â€– comment']),
    (['123 ab'],                ['', '', '123 ab', '' '']),
    #   Multiple lines.
    (['123 ab cd',
      '456 ef gh'],             ['',
                                 '123 ab',
                                 'cd',
                                 '456 ef',
                                 '',
                                 '',
                                 'gh',
                                 '']),
    #   plines starting with a number that are not the start of blines.
    (['12 D 34, 56, 78',
      '90 D'],                  ['12 D 34,',
                                 '56,',
                                 '  78  ',
                                 '90 D'])
])
def test_blines(result, input):
    assert result == blines(input)

def test_stripeol():
    stripeol([bytearray(b'abc')])

    assert [] == stripeol([])

    with pytest.raises(AttributeError):
        stripeol(('a', 'b'))

    lines    = (b'', b'\x1A', b'0', b'1\n', b'2\r', b'3\r\n', b'4\n\r', b'\x1A')
    expected = [b'', b'\x1A', b'0', b'1',   b'2',   b'3',     b'4\n',          ]
    assert expected == stripeol(lines)

    assert [bytearray(b'ab')] == stripeol([bytearray(b'ab\r\n')])
